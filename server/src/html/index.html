<!DOCTYPE html>
<html>
    <head>
        <title>IoT Project - Configuration</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" type="text/css" href="/style/main.css">
        <link rel="stylesheet" type="text/css" href="/style/configuration.css">
    </head>

    <body>
        <div>
            <div class="page-content" >
                    <div class="navbar-div">
                        <ul>
                            <p>IoT Project</p>   
                            <li><a class="active" href="/">Start Page</a></li>
                            <li><a href="/livedata">Live Data</a></li>
                            <li><a href="/rooms">Rooms</a></li>
                        </ul> 
                    </div>
        
                
                <!-- PAGE CONTENT -->
                <div class="content-config">
                    <div style="border-bottom: solid; padding-bottom: 10px;"><font style="margin-left: -400px; font-size: 22px;">Start Page</font></div>
                        <div style="width: 500px; text-align: left; margin-left: 100px;">
                            <p>This is an HTTPs server that utilizes basic HTTP authentication.</p>
                            <p>To interact with the application and to see live data, you need to input your credentials.</p>
                        </div>
                        <div style="text-align: center; margin-top: 100px;">
                           <input id="usn" type="text" placeholder="username"></input><br>
                           <input id="pwd" type="text" placeholdeR="password"></input><br>
                           <button onclick="login()">login</button>
                           <p id="errorMsg"></p>
                        </div>
                <div>
            <div>           
    </body>

    <script>
        function http(url, httptype, payload) {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open(httptype, url, false); 
            xmlHttp.setRequestHeader('Content-type','application/json; charset=utf-8');
            response = undefined;
            xmlHttp.onload = function () {
                    response =  xmlHttp.status;
            }
            xmlHttp.send(payload);
            return response
        }

        function login(){
            username = document.getElementById("usn");
            password = document.getElementById("pwd");

            response = http("http://127.0.0.1:8000/login", "POST", JSON.stringify({"username":username.value, "password":password.value}));
            
            
            error = document.getElementById("errorMsg");
            if (response == 401){
                error.style.color = "red";
                error.innerHTML = "User Unauthorized."
                setCookie("unAutorized", username.value, 1)
            }  else if (response == 200){
                error.style.color = "green";
                error.innerHTML = "Success.";
                setCookie("authorized", username.value, 1);
                username.value = "";
                password.value = "";
            }
        }


        function setCookie(cname, cvalue, exdays) {
            var d = new Date();
            d.setTime(d.getTime() + (exdays*24*60*60*1000));
            var expires = "expires="+ d.toUTCString();

            document.cookie = cname + "=" + escape(cvalue) +  ";" + expires + ";path=/";
        }

        function getCookie(cname) {
            var name = cname + "=";
            var decodedCookie = decodeURIComponent(document.cookie);
            var ca = decodedCookie.split(';');
            for(var i = 0; i <ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
                }
            }
            return "";
        }

    </script>
</html>
